<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Dashboard - Animated</title>
<style>
  body { font-family: Arial, sans-serif; max-width: 900px; margin: 20px auto; background: #f5f7fa; }
  h1 { text-align: center; color: #004080; }
  a {
    display: inline-block; margin-bottom: 15px; color: #004080; text-decoration: none;
    font-weight: bold; transition: color 0.3s ease;
  }
  a:hover { color: #0066cc; }
  .chart-container {
    background: white;
    padding: 20px;
    margin-bottom: 20px;
    border-radius: 8px;
    box-shadow: 0 0 15px rgba(0,0,0,0.1);
  }
</style>
</head>
<body>

<h1>Dashboard</h1>
<a href="index.html">➕ Add Records</a>

<div class="chart-container">
  <h3>Earnings by Month</h3>
  <canvas id="earningsChart"></canvas>
</div>

<div class="chart-container">
  <h3>Task Status</h3>
  <canvas id="statusChart"></canvas>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
<script>
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_AUTH_DOMAIN",
  databaseURL: "YOUR_DATABASE_URL",
  projectId: "YOUR_PROJECT_ID",
  storageBucket: "YOUR_STORAGE_BUCKET",
  messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
  appId: "YOUR_APP_ID"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let monthData = {};
let statusCounts = { completed: 0, pending: 0 };

const baseColors = [
  '#004080', '#0066cc', '#3399ff', '#66b2ff', '#99ccff', '#cce5ff'
];

function lightenColor(color, percent) {
  // Simple lighten function (percent from 0 to 1)
  const num = parseInt(color.replace("#",""),16),
    amt = Math.round(2.55 * percent * 100),
    R = (num >> 16) + amt,
    G = (num >> 8 & 0x00FF) + amt,
    B = (num & 0x0000FF) + amt;
  return "#" + (
    0x1000000 + 
    (R<255?R<1?0:R:255)*0x10000 + 
    (G<255?G<1?0:G:255)*0x100 + 
    (B<255?B<1?0:B:255)
  ).toString(16).slice(1);
}

let earningsChart, statusChart;
let colorShift = 0;

db.ref('records').on('value', (snapshot) => {
  monthData = {};
  statusCounts = { completed: 0, pending: 0 };

  snapshot.forEach(child => {
    const r = child.val();
    if(!r.date) return;
    let month = new Date(r.date).toLocaleString('default', { month: 'short' });
    if (!monthData[month]) monthData[month] = 0;
    monthData[month] += r.amount;
    if (r.status === "completed") statusCounts.completed++;
    if (r.status === "pending") statusCounts.pending++;
  });

  renderCharts();
  animateColors();
});

function renderCharts() {
  const months = Object.keys(monthData);
  const earnings = Object.values(monthData);

  if (earningsChart) earningsChart.destroy();
  if (statusChart) statusChart.destroy();

  earningsChart = new Chart(document.getElementById('earningsChart'), {
    type: 'bar',
    data: {
      labels: months,
      datasets: [{
        label: 'Earnings (₹)',
        data: earnings,
        backgroundColor: baseColors.map(c => lightenColor(c, 0.3)),
        borderColor: baseColors,
        borderWidth: 1
      }]
    },
    options: {
      animation: {
        duration: 1500,
        easing: 'easeInOutQuart'
      },
      scales: {
        y: { beginAtZero: true }
      }
    }
  });

  statusChart = new Chart(document.getElementById('statusChart'), {
    type: 'pie',
    data: {
      labels: ['Completed', 'Pending'],
      datasets: [{
        data: [statusCounts.completed, statusCounts.pending],
        backgroundColor: [baseColors[1], baseColors[4]],
        hoverOffset: 20
      }]
    },
    options: {
      animation: {
        animateRotate: true,
        duration: 1500
      }
    }
  });
}

// Animate pie chart slice colors cycling every 3 seconds
function animateColors() {
  colorShift = (colorShift + 1) % baseColors.length;

  if (!statusChart) return;
  statusChart.data.datasets[0].backgroundColor = [
    baseColors[colorShift],
    baseColors[(colorShift + 3) % baseColors.length]
  ];
  statusChart.update();

  setTimeout(animateColors, 3000);
}
</script>
</body>
</html>
